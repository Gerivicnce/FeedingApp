<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Name="CalendarPageView"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:FeedingApp.Models"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:viewModels="clr-namespace:FeedingApp.ViewModels"
             x:Class="FeedingApp.Views.CalendarPage"
             x:DataType="viewModels:CalendarViewModel"
             Title="NaptÃ¡r">

    <Grid Padding="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- DÃ¡tum vÃ¡lasztÃ³ -->
        <DatePicker Grid.Row="0"
                    Date="{Binding SelectedDate}"
                    DateSelected="OnDateSelected" />

        <!-- Ãllat vÃ¡lasztÃ³ -->
        <Picker Grid.Row="1"
                Title="VÃ¡lassz Ã¡llatot"
                ItemsSource="{Binding Animals}"
                ItemDisplayBinding="{Binding Name}"
                SelectedItem="{Binding SelectedAnimal}" />

        <!-- FotÃ³ kÃ©szÃ­tÃ©se Ã©s etetÃ©s felvÃ©tele -->
        <HorizontalStackLayout Grid.Row="2" Spacing="8">
            <Button Text="ðŸ“· FotÃ³"
                    Clicked="OnTakePhotoClicked" />

            <Button Text="Ãšj etetÃ©s"
                    Clicked="OnAddFeedingClicked" />
        </HorizontalStackLayout>

        <!-- Kamera elÅ‘nÃ©zet -->
        <toolkit:CameraView x:Name="CameraViewControl"
                            Grid.Row="3"
                            HeightRequest="220"
                            HorizontalOptions="Fill" />

        <!-- TÃ¡jÃ©koztatÃ¡s a fotÃ³ mentÃ©sÃ©rÅ‘l -->
        <ContentView Grid.Row="4">
            <Label Text="Az itt kÃ©szÃ­tett fotÃ³ a telefon galÃ©riÃ¡jÃ¡ba kerÃ¼l, Ã­gy az &quot;Ãšj etetÃ©s&quot; ablakban is kivÃ¡laszthatod."
                   Padding="4,8"
                   TextColor="Gray"
                   FontSize="12" />
        </ContentView>

        <!-- Az adott nap etetÃ©sei -->
        <CollectionView Grid.Row="5"
                        ItemsSource="{Binding Events}">
            <CollectionView.EmptyView>
                <Label Text="Nincs etetÃ©s ezen a napon."
                       HorizontalOptions="Center"
                       VerticalOptions="Center"
                       Padding="10"
                       TextColor="Gray" />
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:FeedingEvent">
                    <Border Margin="0,4"
                            Padding="10"
                            Stroke="#dddddd"
                            StrokeThickness="1"
                            StrokeShape="Rectangle">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="{Binding FeedingTime, StringFormat='{0:HH:mm}'}"
                                   FontAttributes="Bold" />
                            <Label Text="{Binding WeightGrams, StringFormat='SÃºly: {0} g'}"
                                   IsVisible="{Binding WeightGrams, Converter={StaticResource NullToBoolConverter}}"
                                   FontSize="12" />
                            <Label Text="{Binding Notes}"
                                   IsVisible="{Binding Notes, Converter={StaticResource StringNotEmptyConverter}}"
                                   FontSize="12" />
                            <Image Source="{Binding PhotoPath}"
                                   Aspect="AspectFill"
                                   HeightRequest="160"
                                   WidthRequest="240"
                                   IsVisible="{Binding PhotoPath, Converter={StaticResource StringNotEmptyConverter}}" />

                            <HorizontalStackLayout Spacing="8" Margin="0,6,0,0">
                                <Button Text="SzerkesztÃ©s"
                                        Padding="10,4"
                                        CommandParameter="{Binding .}"
                                        Clicked="OnEditEventClicked" />
                                <Button Text="TÃ¶rlÃ©s"
                                        Padding="10,4"
                                        BackgroundColor="Tomato"
                                        TextColor="White"
                                        CommandParameter="{Binding .}"
                                        Clicked="OnDeleteEventClicked" />
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- OpciÃ³: aktuÃ¡lis fotÃ³ elÃ©rÃ©si Ãºtja -->
        <Label Grid.Row="6"
               Text="{Binding CurrentPhotoPath}"
               FontSize="10" />
    </Grid>
</ContentPage>
